{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,IACzBH,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFf,EAAyBM,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,GAAO,G,qDCL9D,MAAM,EAA+BC,OAAOC,KAAKC,OAAO,c,MCExDC,GAAAA,aAAiBC,IAAI,kBAAkB,WAAO,ICF9C,MAAM,EAA+BJ,OAAOC,KAAKC,OAAO,a,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,qC,aCAzC,SAASG,EAAgBlB,EAAGmB,GAKzC,OAJAD,EAAkBjB,OAAOmB,eAAiBnB,OAAOmB,eAAeC,OAAS,SAAyBrB,EAAGmB,GAEnG,OADAnB,EAAEsB,UAAYH,EACPnB,CACT,EACOkB,EAAgBlB,EAAGmB,EAC5B,CCLe,SAASI,EAAeC,EAAUC,GAC/CD,EAASjB,UAAYN,OAAOyB,OAAOD,EAAWlB,WAC9CiB,EAASjB,UAAUoB,YAAcH,EACjCJ,EAAeI,EAAUC,EAC3B,CCLA,MAAM,EAA+BZ,OAAOC,KAAKC,OAAO,oB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,yB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uB,aCYnCa,EAAiB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAA,KAAAC,YAAA,KAenC,OAfmCR,EAAAK,EAAAC,GAAAD,EAAArB,UACpCyB,KAAA,WACE,IAAAC,EAA2DC,KAAKC,MAAlDC,EAAQH,EAAdI,KAAgBC,EAAKL,EAALK,MAAO1B,EAAKqB,EAALrB,MAAO2B,EAAMN,EAANM,OAAQC,EAAQP,EAARO,SAE9C,OACEC,EAAA,MAAIC,UAAU,sBACZD,EAAA,QAAMC,UAAU,sBAAsBL,IAAKD,IAC3CK,EAAA,OAAKC,UAAU,yBACbD,EAAA,QAAMC,UAAU,uBAAuBJ,GACvCG,EAAA,QAAMC,UAAU,uBAAuB9B,GACtC4B,GAAYC,EAAA,QAAMC,UAAU,mCAAmCF,IAEjED,GAAUE,EAAA,QAAMC,UAAU,yBAAyBH,GAG1D,EAACX,CAAA,CAfmC,CAASe,KCZ/C,MAAM,EAA+B9B,OAAOC,KAAKC,OAAO,6B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,2B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,sC,aCcnC6B,EAAoB,SAAAC,GAAA,SAAAD,IAAA,QAAAE,EAAAC,EAAAhB,UAAAiB,OAAAC,EAAA,IAAAC,MAAAH,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAAF,EAAAE,GAAApB,UAAAoB,GASf,OATeL,EAAAD,EAAApC,KAAAqB,MAAAe,EAAA,OAAAO,OAAAH,KAAA,MACvCI,UAAI,EACJP,EACAQ,OAAiB,UAASR,EAC1BS,UAA2B,KAAIT,EAC/BU,YAA6B,GAAEV,EAC/BW,WAAK,EAAAX,EACLY,KAAsB,KAAIZ,EAC1Ba,UAAoB,SAAQb,EAC5Bc,SAAmB,EAAKd,CAAA,CATevB,EAAAqB,EAAAC,GASf,IAAAgB,EAAAjB,EAAArC,UAqMvB,OArMuBsD,EAMxBC,OAAA,SAAOC,GACLlB,EAAAtC,UAAMuD,OAAMrD,KAAC,KAAAsD,GAEb7B,KAAKmB,KAAOnB,KAAKC,MAAMkB,KAEvBnB,KAAKuB,MAAQO,IAAO,IAEhB9B,KAAKC,MAAM8B,SACbrB,EAAqBsB,6BAA8B,EACnDtB,EAAqBuB,wBAAyB,EAC9CvB,EAAqBwB,+BAAgC,EAEzD,EAACP,EAEDnB,UAAA,WACE,MAAO,mCACT,EAACmB,EAEDvB,MAAA,WACE,OAAOtB,IAAAA,WAAeqD,MAAM,mDAC9B,EAACR,EAEDS,SAAA,SAASP,GAAiD,IAAAQ,EAAA,KACxD1B,EAAAtC,UAAM+D,SAAQ7D,KAAC,KAAAsD,GAEf,IAAMS,EAAStC,KAAKmB,KAAKoB,KACzBzD,IAAAA,QACW,CACP0D,OAAQ,MACRC,IAAK3D,IAAAA,MAAU4D,UAAU,UAAS,UAAaJ,EAAM,sBAEtDK,MAAK,SAACC,GACLP,EAAKhB,UAAYuB,EAASC,IAC1BR,EAAKb,KAAOoB,EAASpB,KACrBa,EAAKjB,OAAS,YACdb,EAAEuC,QACJ,GACJ,EAACnB,EAEDoB,SAAA,WACE,IAAMC,EAAaC,SAASC,cAAc,sCACtCF,GAAcC,SAASE,gBAAkBH,GAC3CA,EAAWI,OAEf,EAACzB,EAED0B,QAAA,WAAU,IAAAC,EAAA,KACR,OACE/C,EAAA,OAAKC,UAAU,cACI,YAAhBR,KAAKoB,QACJb,EAAA,OAAKC,UAAU,WACbD,EAACgD,IAAgB,MACjBhD,EAAA,SAAIzB,IAAAA,WAAeqD,MAAM,8CAIZ,cAAhBnC,KAAKoB,QACJb,EAAA,WACGP,KAAKC,MAAM8B,QACVxB,EAAA,WACEA,EAAA,SAAIzB,IAAAA,WAAeqD,MAAM,iDAG7B5B,EAAA,OAAKC,UAAU,QACbD,EAACiD,IAAM,CACLhD,UAA8B,WAAnBR,KAAKyB,UAAyB,SAAW,GACpDgC,QAAS,WACPH,EAAK7B,UAAY,SACjBlB,EAAEuC,QACJ,GAEChE,IAAAA,WAAeqD,MAAM,yCAExB5B,EAACiD,IAAM,CACLhD,UAA8B,WAAnBR,KAAKyB,UAAyB,SAAW,GACpDgC,QAAS,WACPH,EAAK7B,UAAY,SACjBlB,EAAEuC,QACJ,GAEChE,IAAAA,WAAeqD,MAAM,8CAIN,WAAnBnC,KAAKyB,WACJlB,EAAA,OAAKC,UAAU,aACbD,EAAA,OAAKC,UAAU,UAAUkD,IAAK1D,KAAKqB,UAAWsC,IAAK7E,IAAAA,WAAeqD,MAAM,+CACxE5B,EAAA,KAAGC,UAAU,YAAY1B,IAAAA,WAAeqD,MAAM,uDAI9B,WAAnBnC,KAAKyB,WACJlB,EAAA,OAAKC,UAAU,sBACbD,EAAA,QAAMC,UAAU,mBAAmBR,KAAKwB,MACxCjB,EAAA,KAAGC,UAAU,YAAY1B,IAAAA,WAAeqD,MAAM,4DAIlD5B,EAAA,OAAKC,UAAU,QACbD,EAAA,QAAMqD,SAAU5D,KAAK6D,SAAS1E,KAAKa,OACjCO,EAAA,OAAKC,UAAU,cACbD,EAAA,SACEuD,KAAK,OACLtD,UAAU,cACVuD,KAAK,QACLC,KAAMhE,KAAKuB,MACX0C,YAAanF,IAAAA,WAAeqD,MAAM,6CAClC+B,UAAU,UACVC,QAAQ,SACRC,aAAa,mBAGjB7D,EAAA,OAAKC,UAAU,cACbD,EAACiD,IAAM,CAACM,KAAK,SAAStD,UAAU,yBAAyBiD,QAASzD,KAAKqE,YAAYlF,KAAKa,MAAO0B,QAAS1B,KAAK0B,SAC1G5C,IAAAA,WAAeqD,MAAM,oDAQjB,uBAAhBnC,KAAKoB,QACJb,EAAA,WACEA,EAAA,SAAIzB,IAAAA,WAAeqD,MAAM,+CACzB5B,EAAA,UACGP,KAAKsB,YAAYgD,KAAI,SAAC9C,GAAI,OACzBjB,EAAA,UACEA,EAAA,YAAOiB,GACJ,KAGTjB,EAAA,SAAIzB,IAAAA,WAAeqD,MAAM,2DACzB5B,EAACiD,IAAM,CACLhD,UAAU,yBACViD,QAAS,WACPH,EAAKlC,OAAS,QACdb,EAAEuC,QACJ,GAEChE,IAAAA,WAAeqD,MAAM,6DAKX,UAAhBnC,KAAKoB,QACJb,EAAA,WACEA,EAAA,SAAIzB,IAAAA,WAAeqD,MAAM,kEACzB5B,EAACiD,IAAM,CAAChD,UAAU,yBAAyBiD,QAASzD,KAAKuE,OAAOpF,KAAKa,OAClElB,IAAAA,WAAeqD,MAAM,6CAMlC,EAACR,EAED0C,YAAA,WAAc,IAAAG,EAAA,KACZxE,KAAK0B,SAAU,EAEf5C,IAAAA,QACW,CACP0D,OAAQ,OACRC,IAAK3D,IAAAA,MAAU4D,UAAU,UAAY,0BACrC+B,KAAM,CACJlD,MAAOvB,KAAKuB,WAGfoB,MAAK,SAACC,GACL,IAAQtB,EAAgBsB,EAAhBtB,YACRkD,EAAKlD,YAAcA,EACnBkD,EAAKpD,OAAS,qBACdb,EAAEuC,QACJ,IAAE,OACK,SAAC4B,GAEN,IACA,SACO,WACPF,EAAK9C,SAAU,CACjB,GACJ,EAACC,EAED4C,OAAA,WAAS,IAAAI,EAAA5E,EACa,OAApB4E,GAAA5E,EAAAC,KAAKC,OAAM2E,YAAXD,EAAApG,KAAAwB,GACAC,KAAK6E,MACP,EAAClD,EAEDkC,SAAA,SAASiB,GACPA,EAAEC,iBACF/E,KAAKqE,aACP,EAAC3D,CAAA,CA9MsC,CAASsE,KAA7BtE,EAWFsB,6BAAuC,EAXrCtB,EAYFuB,wBAAkC,EAZhCvB,EAaFwB,+BAAyC,EC3B5D,MAAM,EAA+BvD,OAAOC,KAAKC,OAAO,2B,aCanCoG,EAA4B,SAAAtE,GAAA,SAAAsE,IAAA,OAAAtE,EAAAf,MAAA,KAAAC,YAAA,KAAAR,EAAA4F,EAAAtE,GAAA,IAAAgB,EAAAsD,EAAA5G,UAuD9C,OAvD8CsD,EAC/CC,OAAA,SAAOC,GACLlB,EAAAtC,UAAMuD,OAAMrD,KAAC,KAAAsD,GAEb7B,KAAK0B,SAAU,CACjB,EAACC,EAEDnB,UAAA,WACE,MAAO,2CACT,EAACmB,EAEDvB,MAAA,WACE,OAAOtB,IAAAA,WAAeqD,MAAM,0DAC9B,EAACR,EAED0B,QAAA,WAAU,IAAA6B,EACFC,GAAyB,OAAhBD,EAAApG,IAAAA,QAAYqC,WAAI,EAAhB+D,EAAkB3C,QAASvC,KAAKC,MAAMkB,KAAKoB,KACpD6C,EAAWpF,KAAKC,MAAMkB,KAC5B,OACEZ,EAAA,OAAKC,UAAU,cACbD,EAAA,SACGzB,IAAAA,WAAeqD,MACdgD,EAAS,yDAA2D,oEACpE,CAAEE,SAAUA,IAASD,MAGzB7E,EAAA,OAAKC,UAAU,cACbD,EAACiD,IAAM,CAAChD,UAAU,wBAAwBiD,QAASzD,KAAKsF,QAAQnG,KAAKa,MAAO0B,QAAS1B,KAAK0B,SACvF5C,IAAAA,WAAeqD,MAAM,qDAExB5B,EAACiD,IAAM,CAAChD,UAAU,wBAAwBiD,QAASzD,KAAK6E,KAAK1F,KAAKa,OAC/DlB,IAAAA,WAAeqD,MAAM,iDAKhC,EAACR,EAED2D,QAAA,WAAU,IAAA1E,EAAA,KACRZ,KAAK0B,SAAU,EACf,IAAMY,EAAStC,KAAKC,MAAMkB,KAAKoB,KAE/BzD,IAAAA,QACW,CACP0D,OAAQ,SACRC,IAAK3D,IAAAA,MAAU4D,UAAU,UAAS,UAAaJ,EAAM,uBAEtDK,MAAK,WACJ/B,EAAKc,SAAU,EACfd,EAAKX,MAAMsF,aACX3E,EAAKiE,MACP,IAAE,OACK,SAACH,GACN,GAEN,EAACO,CAAA,CAvD8C,CAASD,KCGrCQ,EAAa,SAAA7F,GAAA,SAAA6F,IAAA,QAAA5E,EAAAC,EAAAhB,UAAAiB,OAAAC,EAAA,IAAAC,MAAAH,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAAF,EAAAE,GAAApB,UAAAoB,GAIZ,OAJYL,EAAAjB,EAAApB,KAAAqB,MAAAD,EAAA,OAAAuB,OAAAH,KAAA,MAChCI,UAAI,EAAAP,EACJ6E,sBAAgB,EAAA7E,EAChB8E,yBAAmB,EAAA9E,EACnB+E,0BAAoB,EAAA/E,CAAA,CAJYvB,EAAAmG,EAAA7F,GAIZ,IAAAgC,EAAA6D,EAAAnH,UAwGnB,OAxGmBsD,EAEpBC,OAAA,SAAOC,GACLlC,EAAAtB,UAAMuD,OAAMrD,KAAC,KAAAsD,GAEb7B,KAAKmB,KAAOnB,KAAKC,MAAMkB,KACvBnB,KAAKyF,iBAAmBzF,KAAKmB,KAAKsE,mBAClCzF,KAAK0F,oBAAsB1F,KAAKmB,KAAKyE,gBACrC5F,KAAK2F,qBAAuB3F,KAAKmB,KAAKwE,wBAA0B,CAClE,EAAChE,EAED7B,KAAA,WACE,OACES,EAAA,OAAKC,UAAU,iBACbD,EAAA,UAAKsF,IAAU7F,KAAK8F,iBAAiBC,YAG3C,EAACpE,EAEDmE,eAAA,WACE,IAAME,EAAQ,IAAIC,KAEZC,EAAgBlG,KAAKmG,mBACrBC,EACJ7F,EAACiD,IAAM,CAAChD,UAAU,yBAAyBiD,QAASzD,KAAKqG,gBAAgBlH,KAAKa,OAC3ElB,IAAAA,WAAeqD,MAAM,oDAoB1B,OAhBA6D,EAAMjH,IACJ,SACAwB,EAACb,EAAiB,CAChBS,KAAK,oBACLC,MAAOtB,IAAAA,WAAeqD,MAAM,kDAC5BzD,MACEsB,KAAKyF,iBACD3G,IAAAA,WAAeqD,MAAM,oDACrBrD,IAAAA,WAAeqD,MAAM,qDAE3B9B,OAAQL,KAAKyF,iBAAmBS,EAAgBE,EAChD9F,UAAWN,KAAK0F,qBAAuB5G,IAAAA,WAAeqD,MAAM,mDAK3DnC,KAAKyF,kBAEVO,EAAMjH,IACJ,cACAwB,EAACb,EAAiB,CAChBS,KAAK,aACLC,MAAOtB,IAAAA,WAAeqD,MAAM,wDAC5BzD,MAAOsB,KAAK2F,wBAaTK,GApB4BA,CAqBrC,EAACrE,EAEDwE,iBAAA,WACE,IAAMG,EACJ/F,EAACiD,IAAM,CAAChD,UAAU,wBAAwBiD,QAASzD,KAAKuG,iBAAiBpH,KAAKa,MAAOwG,UAAWxG,KAAK0F,qBAClG5G,IAAAA,WAAeqD,MAAM,qDAI1B,OAAQnC,KAAK0F,oBAGXY,EAFA/F,EAACkG,IAAO,CAACC,KAAM5H,IAAAA,WAAeqD,MAAM,yDAA0DmE,EAIlG,EAAC3E,EAED0E,gBAAA,WACEvH,IAAAA,MAAU6H,KAAKjG,EAAsB,CAAEkE,UAAW5E,KAAK4G,mBAAmBzH,KAAKa,MAAOmB,KAAMnB,KAAKmB,MACnG,EAACQ,EAEDiF,mBAAA,WACE5G,KAAKyF,kBAAmB,EACxBlF,EAAEuC,QACJ,EAACnB,EAED4E,iBAAA,WACEzH,IAAAA,MAAU6H,KAAK1B,EAA8B,CAAEM,WAAYvF,KAAK6G,oBAAoB1H,KAAKa,MAAOmB,KAAMnB,KAAKmB,MAC7G,EAACQ,EAEDkF,oBAAA,WACE7G,KAAKyF,kBAAmB,EACxBlF,EAAEuC,QACJ,EAACnB,EAEDmF,oBAAA,WAGEvG,EAAEuC,QACJ,EAAC0C,CAAA,CA5G+B,CAAS/E,KCNtBsG,EAAiB,SAAApH,GAAA,SAAAoH,IAAA,OAAApH,EAAAC,MAAA,KAAAC,YAAA,KAAAR,EAAA0H,EAAApH,GAAA,IAAAgC,EAAAoF,EAAA1I,UAenC,OAfmCsD,EACpCC,OAAA,SAAOC,GACLlC,EAAAtB,UAAMuD,OAAMrD,KAAC,KAAAsD,EAKf,EAACF,EAED7B,KAAA,WACE,OACES,EAAA,WACEA,EAACiF,EAAa,CAACrE,KAAMnB,KAAKC,MAAMkB,OAGtC,EAAC4F,CAAA,CAfmC,CAAStG,KCV/C,MAAM,EAA+B9B,OAAOC,KAAKC,OAAO,8B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,gC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,+B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,oB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,sB,aCIxD,SACE,IAAImI,IAAAA,OAAaC,KACdvE,UAAmB,oBACnBA,UAAmB,iBACnBA,UAAmB,iBACnBA,UAAkB,wBAErB,IAAIsE,IAAAA,OAAaE,KACdxE,UAAmB,gBCVxB,EAAe,GAAfxB,OAAmBiG,GCKnBrI,IAAAA,aAAiBC,IAAI,kBAAkB,YCCrCqI,EAAAA,EAAAA,QAAOC,IAAAA,UAA4B,iBAAiB,SAAUrB,GAC5DA,EAAMjH,IACJ,YACAwB,EAAC+G,IAAQ,CAACC,MAAOzI,IAAAA,WAAeqD,MAAM,qDACpC5B,EAAA,KAAGC,UAAU,YAAY1B,IAAAA,WAAeqD,MAAM,kDAC9C5B,EAAA,KAAGC,UAAU,YACV1B,IAAAA,WAAeqD,MAAM,gDAAiD,CACrEqF,OACEjH,EAACkH,IAAU,CACTC,UAAU,EACVC,KAAK,uFACLC,OAAO,SACPC,IAAI,uBACL,wBAIHC,UACEvH,EAACkH,IAAU,CAACC,UAAU,EAAMC,KAAK,wDAAwDC,OAAO,SAASC,IAAI,uBAAsB,2BAIrIE,MACExH,EAACkH,IAAU,CAACC,UAAU,EAAMC,KAAK,8BAA8BC,OAAO,SAASC,IAAI,uBAAsB,YAM/GtH,EAACwG,EAAiB,CAAC5F,KAAMnB,KAAKmB,QAEhC,IAEJ,KCnCAiG,EAAAA,EAAAA,QAAOY,IAAAA,UAAsB,UAAU,SAAUnG,GAE/C7B,KAAKiI,eAAiBnG,IAAO,IAC7B9B,KAAKkI,mBAAoB,CAC3B,KAEAd,EAAAA,EAAAA,QAAOY,IAAAA,UAAsB,UAAU,SAAUhC,GAAO,IAAApF,EAAA,KAElDZ,KAAKkI,oBACPlC,EAAMjH,IACJ,YACAwB,EAAA,OAAKC,UAAU,6BACbD,EAAA,cAASzB,IAAAA,WAAeqD,MAAM,4DAC9B5B,EAAA,SACEC,UAAU,cACVuD,KAAK,iBACLD,KAAK,OACLG,YAAanF,IAAAA,WAAeqD,MAAM,sDAClCzD,MAAOsB,KAAKiI,iBACZzB,SAAUxG,KAAK0B,QACfwC,UAAU,UACVC,QAAQ,SACRC,aAAa,gBACb+D,QAAS,SAACrD,GACRlE,EAAKqH,eAAenD,EAAEsD,cAAc1J,OAEN,IAA1BoG,EAAE8C,OAAOlJ,MAAMoC,QACjBF,EAAKgD,SAAS,IAAIyE,MAAM,UAE5B,KAGJ,IAGFrC,EAAMsC,OAAO,kBACbtC,EAAMsC,OAAO,YACbtC,EAAMsC,OAAO,YAEjB,KAEAlB,EAAAA,EAAAA,QAAOY,IAAAA,UAAsB,eAAe,SAAUO,GAIpD,OAFAA,EAAKN,eAAiBjI,KAAKiI,iBAEpBM,CACT,KAEAC,EAAAA,EAAAA,UAASR,IAAAA,UAAsB,QAAQ,SAAUS,GAC/C,OAAIzI,KAAKkI,kBACA3H,EAAA,OAAKC,UAAU,uBAAuBR,KAAK0I,SAAS3C,WAGtD0C,GACT,KAEAD,EAAAA,EAAAA,UAASR,IAAAA,UAAsB,UAAU,SAAUS,GACjD,OAAIzI,KAAKkI,kBACA3H,EAAA,YAGFkI,GACT,KAEAD,EAAAA,EAAAA,UAASR,IAAAA,UAAsB,WAAW,SAAUS,EAAU/D,GAC5D,GAAqB,MAAjBA,EAAMtD,OAAgB,CACxB,IAAMuH,EAASjE,EAAM9B,UAAY8B,EAAM9B,SAAS+F,QACtBA,GAAUA,EAAO,IAAMA,EAAO,GAAGC,QAAW,IAEjDC,SAAS,uBAE5B7I,KAAKkI,mBAAoB,GAGzBxD,EAAMoE,MAAMzF,QAAUvE,IAAAA,WAAeqD,MAAM,2CAC3CnC,KAAK+I,WAAarE,EAAMoE,OAE1BvI,EAAEuC,SACF9C,KAAKgJ,SACP,MACEP,EAAS/D,EAEb,ICpFO,IAAIuE,SAAQ,WACjBC,YAAW,WAAM,IAAAhE,EACK,OAApBA,EAAIpG,IAAAA,QAAYqC,OAAZ+D,EAAkBiE,iBACpBrK,IAAAA,MAAU6H,KAAKjG,EAAsB,CAAES,KAAMrC,IAAAA,QAAYqC,KAAMY,QAAQ,GAE3E,GAAG,IACL,GHCF,G","sources":["webpack://@ianm/twofactor/webpack/bootstrap","webpack://@ianm/twofactor/webpack/runtime/compat get default export","webpack://@ianm/twofactor/webpack/runtime/define property getters","webpack://@ianm/twofactor/webpack/runtime/hasOwnProperty shorthand","webpack://@ianm/twofactor/webpack/runtime/make namespace object","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/app']\"","webpack://@ianm/twofactor/./src/common/index.ts","webpack://@ianm/twofactor/external root \"flarum.core.compat['forum/app']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/extend']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['forum/components/UserSecurityPage']\"","webpack://@ianm/twofactor/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ianm/twofactor/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/Component']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/Button']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@ianm/twofactor/./src/forum/components/TwoFactorGridItem.tsx","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@ianm/twofactor/./src/forum/components/TwoFactorEnableModal.tsx","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@ianm/twofactor/./src/forum/components/TwoFactorDisableConfirmModal .tsx","webpack://@ianm/twofactor/./src/forum/components/TwoFactorGrid.tsx","webpack://@ianm/twofactor/./src/forum/components/TwoFactorSettings.tsx","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/FieldSet']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/extenders']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/models/Group']\"","webpack://@ianm/twofactor/external root \"flarum.core.compat['common/models/User']\"","webpack://@ianm/twofactor/./src/common/extend.ts","webpack://@ianm/twofactor/./src/forum/extend.ts","webpack://@ianm/twofactor/./src/forum/index.ts","webpack://@ianm/twofactor/./src/forum/extendUserSecurityPage.tsx","webpack://@ianm/twofactor/./src/forum/extendLogInModal.js","webpack://@ianm/twofactor/./src/forum/checkForTwoFactor.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('ianm/twofactor', () => {});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserSecurityPage'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import Component, { ComponentAttrs } from 'flarum/common/Component';\nimport icon from 'flarum/common/helpers/icon';\nimport type Mithril from 'mithril';\n\nexport interface TwoFactorGridItemAttrs extends ComponentAttrs {\n  icon: string;\n  title: string;\n  value: string;\n  action?: Mithril.Children;\n  helpText?: string;\n}\n\nexport default class TwoFactorGridItem extends Component<TwoFactorGridItemAttrs> {\n  view() {\n    const { icon: iconName, title, value, action, helpText } = this.attrs;\n\n    return (\n      <li className=\"TwoFactorGrid-item\">\n        <span className=\"TwoFactorGrid-icon\">{icon(iconName)}</span>\n        <div className=\"TwoFactorGrid-content\">\n          <span className=\"TwoFactorGrid-title\">{title}</span>\n          <span className=\"TwoFactorGrid-value\">{value}</span>\n          {helpText && <span className=\"helpText TwoFactorGrid-helpText\">{helpText}</span>}\n        </div>\n        {action && <span className=\"TwoFactorGrid-actions\">{action}</span>}\n      </li>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import app from 'flarum/forum/app';\nimport Modal, { IInternalModalAttrs } from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Stream from 'flarum/common/utils/Stream';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport User from 'flarum/common/models/User';\nimport type Mithril from 'mithril';\n\nexport interface TwoFactorEnableModalAttrs extends IInternalModalAttrs {\n  user: User;\n  forced: boolean;\n  onEnabled: () => void | null;\n}\n\nexport default class TwoFactorEnableModal extends Modal<TwoFactorEnableModalAttrs> {\n  user!: User;\n  // Statuses: 'loading', 'displayQR', 'displayBackupCodes', 'final'\n  status: string = 'loading';\n  qrCodeUrl: string | null = null;\n  backupCodes: Array<string> = [];\n  token: Stream<string>;\n  code: string | null = null;\n  activeTab: string = 'qrcode';\n  loading: boolean = false;\n\n  protected static isDismissibleViaCloseButton: boolean = true;\n  protected static isDismissibleViaEscKey: boolean = true;\n  protected static isDismissibleViaBackdropClick: boolean = true;\n\n  oninit(vnode: Mithril.Vnode<TwoFactorEnableModalAttrs>) {\n    super.oninit(vnode);\n\n    this.user = this.attrs.user;\n\n    this.token = Stream('');\n\n    if (this.attrs.forced) {\n      TwoFactorEnableModal.isDismissibleViaCloseButton = false;\n      TwoFactorEnableModal.isDismissibleViaEscKey = false;\n      TwoFactorEnableModal.isDismissibleViaBackdropClick = false;\n    }\n  }\n\n  className() {\n    return 'TwoFactorEnableModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans('ianm-twofactor.forum.security.two_factor_heading');\n  }\n\n  oncreate(vnode: Mithril.Vnode<TwoFactorEnableModalAttrs>) {\n    super.oncreate(vnode);\n\n    const userId = this.user.id();\n    app\n      .request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + `/users/${userId}/twofactor/qrcode`,\n      })\n      .then((response: any) => {\n        this.qrCodeUrl = response.svg;\n        this.code = response.code;\n        this.status = 'displayQR';\n        m.redraw();\n      });\n  }\n\n  onupdate() {\n    const tokenInput = document.querySelector('.TwoFactorEnableModal [name=token]') as HTMLInputElement;\n    if (tokenInput && document.activeElement !== tokenInput) {\n      tokenInput.focus();\n    }\n  }\n\n  content() {\n    return (\n      <div className=\"Modal-body\">\n        {this.status === 'loading' && (\n          <div className=\"loading\">\n            <LoadingIndicator />\n            <p>{app.translator.trans('ianm-twofactor.forum.security.loading_qr')}</p>\n          </div>\n        )}\n\n        {this.status === 'displayQR' && (\n          <div>\n            {this.attrs.forced && (\n              <div>\n                <p>{app.translator.trans('ianm-twofactor.forum.user_2fa.alert_message')}</p>\n              </div>\n            )}\n            <div className=\"tabs\">\n              <Button\n                className={this.activeTab === 'qrcode' ? 'active' : ''}\n                onclick={() => {\n                  this.activeTab = 'qrcode';\n                  m.redraw();\n                }}\n              >\n                {app.translator.trans('ianm-twofactor.forum.security.qr_tab')}\n              </Button>\n              <Button\n                className={this.activeTab === 'manual' ? 'active' : ''}\n                onclick={() => {\n                  this.activeTab = 'manual';\n                  m.redraw();\n                }}\n              >\n                {app.translator.trans('ianm-twofactor.forum.security.manual_tab')}\n              </Button>\n            </div>\n\n            {this.activeTab === 'qrcode' && (\n              <div className=\"qrSection\">\n                <img className=\"qrImage\" src={this.qrCodeUrl} alt={app.translator.trans('ianm-twofactor.forum.security.qr_code_alt')} />\n                <p className=\"helpText\">{app.translator.trans('ianm-twofactor.forum.security.scan_qr_instruction')}</p>\n              </div>\n            )}\n\n            {this.activeTab === 'manual' && (\n              <div className=\"manualEntrySection\">\n                <code className=\"manualEntryCode\">{this.code}</code>\n                <p className=\"helpText\">{app.translator.trans('ianm-twofactor.forum.security.manual_entry_instruction')}</p>\n              </div>\n            )}\n\n            <div className=\"Form\">\n              <form onsubmit={this.onSubmit.bind(this)}>\n                <div className=\"Form-group\">\n                  <input\n                    type=\"text\"\n                    className=\"FormControl\"\n                    name=\"token\"\n                    bidi={this.token}\n                    placeholder={app.translator.trans('ianm-twofactor.forum.security.enter_token')}\n                    inputmode=\"numeric\"\n                    pattern=\"[0-9]*\"\n                    autocomplete=\"one-time-code\"\n                  />\n                </div>\n                <div className=\"Form-group\">\n                  <Button type=\"submit\" className=\"Button Button--primary\" onclick={this.verifyToken.bind(this)} loading={this.loading}>\n                    {app.translator.trans('ianm-twofactor.forum.security.verify_button')}\n                  </Button>\n                </div>\n              </form>\n            </div>\n          </div>\n        )}\n\n        {this.status === 'displayBackupCodes' && (\n          <div>\n            <p>{app.translator.trans('ianm-twofactor.forum.security.backup_codes')}</p>\n            <ul>\n              {this.backupCodes.map((code) => (\n                <li>\n                  <code>{code}</code>\n                </li>\n              ))}\n            </ul>\n            <p>{app.translator.trans('ianm-twofactor.forum.security.backup_codes_instruction')}</p>\n            <Button\n              className=\"Button Button--primary\"\n              onclick={() => {\n                this.status = 'final';\n                m.redraw();\n              }}\n            >\n              {app.translator.trans('ianm-twofactor.forum.security.saved_backup_codes_button')}\n            </Button>\n          </div>\n        )}\n\n        {this.status === 'final' && (\n          <div>\n            <p>{app.translator.trans('ianm-twofactor.forum.security.two_factor_enabled_confirmation')}</p>\n            <Button className=\"Button Button--primary\" onclick={this.finish.bind(this)}>\n              {app.translator.trans('ianm-twofactor.forum.security.ok_button')}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  verifyToken() {\n    this.loading = true;\n\n    app\n      .request({\n        method: 'POST',\n        url: app.forum.attribute('apiUrl') + '/users/twofactor/verify',\n        body: {\n          token: this.token(),\n        },\n      })\n      .then((response: unknown) => {\n        const { backupCodes } = response as { backupCodes: string[] };\n        this.backupCodes = backupCodes;\n        this.status = 'displayBackupCodes';\n        m.redraw();\n      })\n      .catch((error) => {\n        //alert('Verification failed. Please try again.');\n        //error.alert.content = 'Verification failed. Please try again.';\n      })\n      .finally(() => {\n        this.loading = false;\n      });\n  }\n\n  finish() {\n    this.attrs.onEnabled?.();\n    this.hide();\n  }\n\n  onSubmit(e: any) {\n    e.preventDefault();\n    this.verifyToken();\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport User from 'flarum/common/models/User';\nimport { ILoginModalAttrs } from 'flarum/forum/components/LogInModal';\nimport type Mithril from 'mithril';\nimport username from 'flarum/common/helpers/username';\n\nexport interface TwoFactorDisableConfirmModalAttrs extends ILoginModalAttrs {\n  user: User;\n  onDisabled: () => void;\n}\n\nexport default class TwoFactorDisableConfirmModal extends Modal<TwoFactorDisableConfirmModalAttrs> {\n  oninit(vnode: Mithril.Vnode<TwoFactorDisableConfirmModalAttrs, this>) {\n    super.oninit(vnode);\n\n    this.loading = false;\n  }\n\n  className() {\n    return 'TwoFactorDisableConfirmModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans('ianm-twofactor.forum.security.confirm_disable_2fa_title');\n  }\n\n  content() {\n    const isSelf = app.session.user?.id() === this.attrs.user.id();\n    const thisUser = this.attrs.user;\n    return (\n      <div className=\"Modal-body\">\n        <p>\n          {app.translator.trans(\n            isSelf ? 'ianm-twofactor.forum.security.confirm_disable_2fa_text' : 'ianm-twofactor.forum.security.confirm_disable_2fa_text_other_user',\n            { username: username(thisUser) }\n          )}\n        </p>\n        <div className=\"Form-group\">\n          <Button className=\"Button Button--danger\" onclick={this.disable.bind(this)} loading={this.loading}>\n            {app.translator.trans('ianm-twofactor.forum.security.disable_2fa_button')}\n          </Button>\n          <Button className=\"Button Button--cancel\" onclick={this.hide.bind(this)}>\n            {app.translator.trans('ianm-twofactor.forum.security.cancel_button')}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  disable() {\n    this.loading = true;\n    const userId = this.attrs.user.id();\n\n    app\n      .request({\n        method: 'DELETE',\n        url: app.forum.attribute('apiUrl') + `/users/${userId}/twofactor/disable`,\n      })\n      .then(() => {\n        this.loading = false;\n        this.attrs.onDisabled();\n        this.hide();\n      })\n      .catch((error) => {\n        // Handle any errors.\n      });\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport listItems from 'flarum/common/helpers/listItems';\nimport TwoFactorGridItem from './TwoFactorGridItem';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport TwoFactorEnableModal from './TwoFactorEnableModal';\nimport TwoFactorDisableConfirmModal from './TwoFactorDisableConfirmModal ';\nimport type Mithril from 'mithril';\nimport User from 'flarum/common/models/User';\n\nexport interface TwoFactorGridAttrs extends ComponentAttrs {\n  user: User;\n}\n\nexport default class TwoFactorGrid extends Component<TwoFactorGridAttrs> {\n  user!: User;\n  twoFactorEnabled!: boolean;\n  canDisableTwoFactor!: boolean;\n  backupCodesRemaining!: number;\n\n  oninit(vnode: Mithril.Vnode<ComponentAttrs, this>) {\n    super.oninit(vnode);\n\n    this.user = this.attrs.user;\n    this.twoFactorEnabled = this.user.twoFactorEnabled();\n    this.canDisableTwoFactor = this.user.canDisable2FA();\n    this.backupCodesRemaining = this.user.backupCodesRemaining() || 0;\n  }\n\n  view() {\n    return (\n      <div className=\"TwoFactorGrid\">\n        <ul>{listItems(this.twoFactorItems().toArray())}</ul>\n      </div>\n    );\n  }\n\n  twoFactorItems() {\n    const items = new ItemList();\n\n    const disableAction = this.getDisableAction();\n    const enableAction = (\n      <Button className=\"Button Button--primary\" onclick={this.enableTwoFactor.bind(this)}>\n        {app.translator.trans('ianm-twofactor.forum.security.enable_2fa_button')}\n      </Button>\n    );\n\n    items.add(\n      'status',\n      <TwoFactorGridItem\n        icon=\"fas fa-shield-alt\"\n        title={app.translator.trans('ianm-twofactor.forum.security.two_factor_title')}\n        value={\n          this.twoFactorEnabled\n            ? app.translator.trans('ianm-twofactor.forum.security.two_factor_enabled')\n            : app.translator.trans('ianm-twofactor.forum.security.two_factor_disabled')\n        }\n        action={this.twoFactorEnabled ? disableAction : enableAction}\n        helpText={!this.canDisableTwoFactor && app.translator.trans('ianm-twofactor.forum.security.cannot_disable')}\n      />\n    );\n\n    // Only continue to add other items if Two Factor Authentication is enabled\n    if (!this.twoFactorEnabled) return items;\n\n    items.add(\n      'backupCodes',\n      <TwoFactorGridItem\n        icon=\"fas fa-key\"\n        title={app.translator.trans('ianm-twofactor.forum.security.backup_codes_remaining')}\n        value={this.backupCodesRemaining}\n        // action={\n        //   this.backupCodesRemaining < 2 ? (\n        //     <Button className=\"Button Button--primary\" onclick={this.generateBackupCodes.bind(this)}>\n        //       {app.translator.trans('ianm-twofactor.forum.security.generate_backup_codes_button')}\n        //     </Button>\n        //   ) : null\n        // }\n      />\n    );\n\n    // Add other items as needed\n\n    return items;\n  }\n\n  getDisableAction() {\n    const disableButton = (\n      <Button className=\"Button Button--danger\" onclick={this.disableTwoFactor.bind(this)} disabled={!this.canDisableTwoFactor}>\n        {app.translator.trans('ianm-twofactor.forum.security.disable_2fa_button')}\n      </Button>\n    );\n\n    return !this.canDisableTwoFactor ? (\n      <Tooltip text={app.translator.trans('ianm-twofactor.forum.security.cannot_disable_tooltip')}>{disableButton}</Tooltip>\n    ) : (\n      disableButton\n    );\n  }\n\n  enableTwoFactor() {\n    app.modal.show(TwoFactorEnableModal, { onEnabled: this.onTwoFactorEnabled.bind(this), user: this.user });\n  }\n\n  onTwoFactorEnabled() {\n    this.twoFactorEnabled = true;\n    m.redraw();\n  }\n\n  disableTwoFactor() {\n    app.modal.show(TwoFactorDisableConfirmModal, { onDisabled: this.onTwoFactorDisabled.bind(this), user: this.user });\n  }\n\n  onTwoFactorDisabled() {\n    this.twoFactorEnabled = false;\n    m.redraw();\n  }\n\n  generateBackupCodes() {\n    // Logic to generate more backup codes\n    // Update this.backupCodesRemaining accordingly\n    m.redraw();\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\nimport TwoFactorGrid from './TwoFactorGrid';\nimport type Mithril from 'mithril';\nimport User from 'flarum/common/models/User';\n\nexport interface TwoFactorSettingsAttrs extends ComponentAttrs {\n  user: User;\n}\n\nexport default class TwoFactorSettings extends Component<TwoFactorSettingsAttrs> {\n  oninit(vnode: Mithril.Vnode<ComponentAttrs, this>) {\n    super.oninit(vnode);\n\n    // this.twoFactorEnabled = this.attrs.user.twoFactorEnabled();\n    // this.canDisableTwoFactor = this.attrs.user.canDisable2FA();\n    // this.loading = false;\n  }\n\n  view() {\n    return (\n      <div>\n        <TwoFactorGrid user={this.attrs.user} />\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/FieldSet'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","import Extend from 'flarum/common/extenders';\nimport Group from 'flarum/common/models/Group';\nimport User from 'flarum/common/models/User';\n\nexport default [\n  new Extend.Model(User) //\n    .attribute<boolean>('twoFactorEnabled')\n    .attribute<boolean>('canDisable2FA')\n    .attribute<boolean>('mustEnable2FA')\n    .attribute<number>('backupCodesRemaining'),\n\n  new Extend.Model(Group) //\n    .attribute<boolean>('requires2FA'),\n];\n","import commonExtend from '../common/extend';\n\nexport default [...commonExtend];\n","import app from 'flarum/forum/app';\nimport extendUserSecurityPage from './extendUserSecurityPage';\nimport extendLogInModal from './extendLogInModal';\nimport checkForTwoFactor from './checkForTwoFactor';\n\nexport { default as extend } from './extend';\n\napp.initializers.add('ianm/twofactor', () => {\n  extendUserSecurityPage();\n  extendLogInModal();\n  checkForTwoFactor();\n});\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport UserSecurityPage from 'flarum/forum/components/UserSecurityPage';\nimport TwoFactorSettings from './components/TwoFactorSettings';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport LinkButton from 'flarum/common/components/LinkButton';\n\nexport default function extendUserSecurityPage() {\n  extend(UserSecurityPage.prototype, 'settingsItems', function (items) {\n    items.add(\n      'twoFactor',\n      <FieldSet label={app.translator.trans('ianm-twofactor.forum.security.two_factor_heading')}>\n        <p className=\"helpText\">{app.translator.trans('ianm-twofactor.forum.security.two_factor_help')}</p>\n        <p className=\"helpText\">\n          {app.translator.trans('ianm-twofactor.forum.security.two_factor_apps', {\n            google: (\n              <LinkButton\n                external={true}\n                href=\"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                Google Authenticator\n              </LinkButton>\n            ),\n            microsoft: (\n              <LinkButton external={true} href=\"https://www.microsoft.com/en-us/account/authenticator\" target=\"_blank\" rel=\"noopener noreferrer\">\n                Microsoft Authenticator\n              </LinkButton>\n            ),\n            authy: (\n              <LinkButton external={true} href=\"https://authy.com/download/\" target=\"_blank\" rel=\"noopener noreferrer\">\n                Authy\n              </LinkButton>\n            ),\n          })}\n        </p>\n        <TwoFactorSettings user={this.user} />\n      </FieldSet>,\n      100\n    );\n  });\n}\n","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default function extendLogInModal() {\n  extend(LogInModal.prototype, 'oninit', function (vnode) {\n    // Initialize the 2FA token stream\n    this.twoFactorToken = Stream('');\n    this.twoFactorRequired = false;\n  });\n\n  extend(LogInModal.prototype, 'fields', function (items) {\n    // Add the 2FA input field to the form\n    if (this.twoFactorRequired) {\n      items.add(\n        'twoFactor',\n        <div className=\"Form-group TwoFactorInput\">\n          <legend>{app.translator.trans('ianm-twofactor.forum.log_in.two_factor_required_message')}</legend>\n          <input\n            className=\"FormControl\"\n            name=\"twoFactorToken\"\n            type=\"text\"\n            placeholder={app.translator.trans('ianm-twofactor.forum.log_in.two_factor_placeholder')}\n            value={this.twoFactorToken()}\n            disabled={this.loading}\n            inputmode=\"numeric\"\n            pattern=\"[0-9]*\"\n            autocomplete=\"one-time-code\"\n            oninput={(e) => {\n              this.twoFactorToken(e.currentTarget.value);\n\n              if (e.target.value.length === 6) {\n                this.onsubmit(new Event('submit')); // Trigger the onsubmit method\n              }\n            }}\n          />\n        </div>,\n        19\n      );\n\n      items.remove('identification');\n      items.remove('password');\n      items.remove('remember');\n    }\n  });\n\n  extend(LogInModal.prototype, 'loginParams', function (data) {\n    // Add the twoFactorToken to the login params\n    data.twoFactorToken = this.twoFactorToken();\n\n    return data;\n  });\n\n  override(LogInModal.prototype, 'body', function (original) {\n    if (this.twoFactorRequired) {\n      return <div className=\"Form Form--centered\">{this.fields().toArray()}</div>;\n    }\n\n    return original();\n  });\n\n  override(LogInModal.prototype, 'footer', function (original) {\n    if (this.twoFactorRequired) {\n      return <div />;\n    }\n\n    return original();\n  });\n\n  override(LogInModal.prototype, 'onerror', function (original, error) {\n    if (error.status === 422) {\n      const errors = error.response && error.response.errors;\n      const firstErrorDetail = (errors && errors[0] && errors[0].detail) || '';\n\n      if (firstErrorDetail.includes('two_factor_required')) {\n        // If the error indicates that 2FA is required, show the 2FA input field\n        this.twoFactorRequired = true;\n      } else {\n        // Handle other types of 422 errors here\n        error.alert.content = app.translator.trans('core.forum.log_in.invalid_login_message');\n        this.alertAttrs = error.alert;\n      }\n      m.redraw();\n      this.onready();\n    } else {\n      original(error);\n    }\n  });\n}\n","import app from 'flarum/forum/app';\nimport TwoFactorEnableModal from './components/TwoFactorEnableModal';\n\nexport default function checkForTwoFactor() {\n  return new Promise(() => {\n    setTimeout(() => {\n      if (app.session.user?.mustEnable2FA()) {\n        app.modal.show(TwoFactorEnableModal, { user: app.session.user, forced: true });\n      }\n    }, 300);\n  });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","TwoFactorGridItem","_Component","apply","arguments","view","_this$attrs","this","attrs","iconName","icon","title","action","helpText","m","className","Component","TwoFactorEnableModal","_Modal","_this","_len","length","args","Array","_key","concat","user","status","qrCodeUrl","backupCodes","token","code","activeTab","loading","_proto","oninit","vnode","Stream","forced","isDismissibleViaCloseButton","isDismissibleViaEscKey","isDismissibleViaBackdropClick","trans","oncreate","_this2","userId","id","method","url","attribute","then","response","svg","redraw","onupdate","tokenInput","document","querySelector","activeElement","focus","content","_this3","LoadingIndicator","Button","onclick","src","alt","onsubmit","onSubmit","type","name","bidi","placeholder","inputmode","pattern","autocomplete","verifyToken","map","finish","_this4","body","error","_this$attrs$onEnabled","onEnabled","hide","e","preventDefault","Modal","TwoFactorDisableConfirmModal","_app$session$user","isSelf","thisUser","username","disable","onDisabled","TwoFactorGrid","twoFactorEnabled","canDisableTwoFactor","backupCodesRemaining","canDisable2FA","listItems","twoFactorItems","toArray","items","ItemList","disableAction","getDisableAction","enableAction","enableTwoFactor","disableButton","disableTwoFactor","disabled","Tooltip","text","show","onTwoFactorEnabled","onTwoFactorDisabled","generateBackupCodes","TwoFactorSettings","Extend","User","Group","commonExtend","extend","UserSecurityPage","FieldSet","label","google","LinkButton","external","href","target","rel","microsoft","authy","LogInModal","twoFactorToken","twoFactorRequired","oninput","currentTarget","Event","remove","data","override","original","fields","errors","detail","includes","alert","alertAttrs","onready","Promise","setTimeout","mustEnable2FA"],"sourceRoot":""}